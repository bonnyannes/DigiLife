<!DOCTYPE html>
<html>
   <head>
      <link rel="stylesheet" href="digilife.css">
      <title>DigiLife</title>
   <style>
       .container {
          position: relative;
       }
       .centerer {
          text-align: center;
          margin: 20px auto;
          width: 80%;
       }
       .button {
          cursor: pointer;
          border: 3px solid #27AE60;
          border-radius: 30px;
          width: 200px;
          margin: 10px auto;
          padding: 10px 0;
          background-color: #27AE60
          text color: #fff
       }
       .button:hover {
          background-color: #003306;
          border: 3px solid #003306;
          color: #;
       }
       .btn-small {
          width: 100px;
       }

       .error-message {
          color: red;
          display; none;
       }
       #xregistration-page,#successful-registration,
       #claim-page,#pending-verification,
       #claim-approval-confirmation {
          display: none;
       }
       .green {
          color: #27AE60;
       } 
       input {
          height: 25px;
          font-size: 15px;
       }
   
       .spacer {
          padding: 10px 0;
       }
       
       #age-required { 
          opacity: 0;
          font-size: 12px;
       }

   </style>
   </head>
   <body>
     <header><img src="Images/juniperlogo.png" width="200" height="65" alt="logo">

     </header>
       <div id="registration-page" class="centerer">
          <img src="Images/contract.svg" alt="contract"/>
          <h1>Welcome back!</h1>
          <p>Please input your information....</p>
          <div id="gender">I am a <select>
             <option value="1">female</option>
             <option value="2">male</option>
             </select>
          </div>
          <div class="spacer"> </div>
          <div><label>Age:</label><input id="age"></input>
             <div id="age-required" class="error-message">** required</div>
          </div>
          <div><label>Smoking:</label>
             <select id="smoking">
                <option value="false">false</option>
                <option value="true">true</option>
             </select>
          </div>
          <div id="submit-registration" class="button">Registration</div>
          <div class="error-message"></div>
       </div>

       <div id="successful-registration" class="centerer">
          <img src="Images/smile.png" alt="smile"/>
          <h1>You're almost done!</h1>
          <p>This is your policy number. Please keep it safe, it's very <b>important</b>!</p>
          <div id="policyNumber">EQ1239</div>
          <div id="goto-claim-page" class="button btn-small">Confirmation</div>
       </div>

       <div id="claim-page" class="centerer">
          <img src="Images/frownface.png" alt="Sad">
          <h1>We're sorry for your loss.</h1>
          <p>To submit a claim please upload the necessary documentation and enter your key</p>
          <div><label>Policy Number: </label><input id="claim-policy-no"></input></div>
          <img src="Images/arrow.png" alt="arrow" width="50" height="60" >
          <div id="submit-claim-button" class="button">Submit Claim</div>
          <div class="error-message"></div>
       </div>
       <div id="pending-verification" class="centerer">
          <img src="Images/mail.png" alt="mail"/>
          <h1>Pending Registration...</h1>
          <p>Your claim is being processed. There is a 30 day verification period before funds will be released into your account.</p>
          <img src="Images/checklist.png" alt="checklist"/>
          <div id="next-button" class="button btn-small">Next</div>
          
       </div>
       <div id="claim-approval-confirmation" class="centerer">
          <img src="Images/umbrella.png" alt="mail"/>
          <h1>Your claim has been confirmed!</h1>
          <img src="Images/checkmark.png" alt="checkmark"/>
          <p>Your funds have been released. Please check your email.</p> 
          <h1 class="green">Thanks!</h1>
       </div>
       <script src="https://cdn.ethers.io/scripts/ethers-app-v0.5.min.js"
        charset="utf-8" type="text/javascript">
       </script>
       <script src="abi.js" charset="utf-8" type="text/javascript"></script>
       <script>
           ethers.onready = startApp;
           var policyNumber = 0;
           var address = "0x299f22ee3d479033974efb11a60d3691a25ece44";

           function startApp() {
               document.getElementById("submit-claim-button").onclick = submitClaim;
               document.getElementById("next-button").onclick = nextClicked;
               document.getElementById("submit-registration").onclick = doRegistration;
               document.getElementById("goto-claim-page").onclick = gotoClaim;
           }
 
           function gotoClaim() {
               document.getElementById("claim-page").style.display = "block";
               document.getElementById("successful-registration").style.display = "none";
           }

           function generatePolicyNumber() {
               var max = 99999;
               var min = 1;
               return Math.random() * (max - min) + min;
           }


           function validateInputs() {
               var age = document.getElementById("age").value;
               console.log("xx", age);
               if( age == "" ) {
                  console.log("nxx", age);
                  document.getElementById("age-required").style.opacity=1;
                  return false;
               }
               document.getElementById("age-required").style.opacity=0;
               return true;
           }

           function doRegistration(){
               var error = this.nextElementSibling;
               if( !validateInputs() ) return;

               ethers.getNetwork().then(function(network){
                  console.log('registration network', network);
                  ethers.getAccount().then(function(account){
                     console.log('account', account);
                     if( account == null )
                     {
                         logError(error, "account required");
                         return;
                     }
                     var contract = ethers.getContract(address, abi);
                     var gender = document.getElementById("gender").value;
                     var age = document.getElementById("age").value;
                     var smoking = document.getElementById("smoking").value;
                     var country = "CA";
                     policyNumber = generatePolicyNumber();
                     var risk = 75;
                     console.log("xx",  policyNumber, risk, age);
                     contract.Register(gender, age, smoking, country, policyNumber, risk)
                     .then(function(txhash){
                        console.log('submitted', txhash);
                        document.getElementById("successful-registration").style.display="block";
                        document.getElementById("#registration-page").style.display="none";
                     }, function(reject){
                        console.log('rejected', reject);
                        logError(reject);
                     });
                  });
               });
           }

           function nextClicked() {
               document.getElementById("claim-approval-confirmation").style.display = "block";
               document.getElementById("pending-verification").style.display = "none";
           }

           function submitClaim() {
               ethers.getNetwork().then(function(network){
                  console.log('network', network);
                  ethers.getAccount().then(function(account){
                     console.log('account', account);
                     if( account == null )
                     {
                         logError("account required");
                         return;
                     }
                     var contract = ethers.getContract(address, abi);
                     contract.Claim(policyNumber).then(function(txhash){
                        console.log('submitted', txhash);
                        document.getElementById("pending-verification").style.display="block";
                        document.getElementById("claim-page").style.display="none";
                     }, function(reject){
                        console.log('rejected', reject);
                     });
                  });
               });
           }
           function logError(error, message){
               error.textContent = message;
               error.style.display = "";

           }
       </script>
   </body>
</html>
